import{A as v,B as F,C as T,D as A,a as I,F as b,b as x,c as k,d as B,G as R,Q as $,e as V,f as q,g as Q,h as L,i as N,j as M,S as O,T as U,k as j,V as W,_ as z,l as K,m as G,n as H,o as J,p as X,q as Y,r as Z,s as ee,t as te,u as oe,v as re,w as se,x as ne,y as ae,z as ce,E as ie,H as le,I as de,J as ue,K as me,L as fe,M as he,N as pe,O as ye,P as _e,R as Ee}from"./firebase-CSiidJbk.js";const ge=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:v,Bytes:F,CollectionReference:T,DocumentReference:A,DocumentSnapshot:I,FieldPath:b,FieldValue:x,Firestore:k,FirestoreError:B,GeoPoint:R,Query:$,QueryCompositeFilterConstraint:V,QueryConstraint:q,QueryDocumentSnapshot:Q,QueryFieldFilterConstraint:L,QueryOrderByConstraint:N,QuerySnapshot:M,SnapshotMetadata:O,Timestamp:U,Transaction:j,VectorValue:W,_AutoId:z,_ByteString:K,_DatabaseId:G,_DocumentKey:H,_EmptyAuthCredentialsProvider:J,_FieldPath:X,_cast:Y,_logWarn:Z,_validateIsNotUsedTogether:ee,addDoc:te,collection:oe,connectFirestoreEmulator:re,deleteDoc:se,doc:ne,ensureFirestoreConfigured:ae,executeWrite:ce,getDoc:ie,getDocs:le,getFirestore:de,increment:ue,orderBy:me,query:fe,runTransaction:he,serverTimestamp:pe,setDoc:ye,updateDoc:_e,where:Ee},Symbol.toStringTag,{value:"Module"})),we="modulepreload",Pe=function(o){return"/"+o},S={},Ce=function(f,a,w){let h=Promise.resolve();if(a&&a.length>0){let E=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),s=c?.nonce||c?.getAttribute("nonce");h=E(a.map(r=>{if(r=Pe(r),r in S)return;S[r]=!0;const d=r.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${u}`))return;const e=document.createElement("link");if(e.rel=d?"stylesheet":we,d||(e.as="script"),e.crossOrigin="",e.href=r,s&&e.setAttribute("nonce",s),document.head.appendChild(e),d)return new Promise((p,m)=>{e.addEventListener("load",p),e.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}function l(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return h.then(c=>{for(const s of c||[])s.status==="rejected"&&l(s.reason);return f().catch(l)})},D=document.querySelector(".username");window.onAuth(async o=>{if(o){const f=await window.getUserProfile(o.uid);f.exists()?D.textContent=`ようこそ, ${f.data().username}さん!`:D.textContent="ようこそ, ユーザーさん!";const a=document.getElementById("history-list");if(a){const{getFirestore:w,collection:h,getDocs:l,orderBy:c,query:s,where:E}=await Ce(async()=>{const{getFirestore:e,collection:p,getDocs:m,orderBy:g,query:n,where:t}=await Promise.resolve().then(()=>ge);return{getFirestore:e,collection:p,getDocs:m,orderBy:g,query:n,where:t}},void 0),r=w(),d=s(h(r,"history"),E("uid","==",o.uid),c("time","desc")),u=await l(d);if(u.empty){const e=document.createElement("li");e.textContent="閲覧履歴はまだありません",a.appendChild(e)}else{const e=new Map;u.forEach(n=>{const t=n.data();t.url&&!e.has(t.url)&&e.set(t.url,{...t})});const p=Array.from(e.entries()).slice(0,10),m=p.map(([n])=>n);let g={};if(m.length>0){const n=[];for(let t=0;t<m.length;t+=10)n.push(m.slice(t,t+10));for(const t of n){const y=s(h(r,"files"),E("url","in",t));(await l(y)).forEach(_=>{const i=_.data();i.url&&(g[i.url]=i)})}}p.forEach(([n,t])=>{const y=g[n]||{},C=t.time&&t.time.toDate?t.time.toDate().toLocaleString():"",_=document.createElement("li"),i=document.createElement("a");i.href=n,i.target="_blank",i.className="pdf-link",i.textContent=`${y.year||""} ${y.name||""} ${y.teacher||""}`;const P=document.createElement("span");P.style.cssText="font-size:0.9em;color:#888;",P.textContent=` ${C}`,_.appendChild(i),_.appendChild(P),a.appendChild(_)})}}}else window.location.href="/login.html"});const Se=async()=>{try{const o=await fetch("/components/footer");if(!o.ok)throw new Error(`フッターの読み込みに失敗しました: ${o.status} ${o.statusText}`);const f=await o.text(),a=document.getElementById("footer-placeholder");if(a){const l=new DOMParser().parseFromString(f,"text/html").querySelector("footer");l&&a.appendChild(l.cloneNode(!0))}else console.error("エラー: フッターのプレースホルダー要素が見つかりません。")}catch(o){console.error("フッターの読み込み中にエラーが発生しました:",o)}};await Se();
