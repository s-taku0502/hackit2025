<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/list.css">
    <title>è³ªå•ãƒ»è¿”ç­”ä¸€è¦§</title>
</head>

<body>
    <div class="wrapper">
        <header class="header">
            <div>
                <img src="/img/hackit.png" alt="Hackit Logo" class="logo">
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="/">ãƒ›ãƒ¼ãƒ </a></li>
                    <li><a href="/contributor/new">éå»å•æŠ•ç¨¿</a></li>
                    <li><a href="/viewer/question/list" class="active">è³ªå•ãƒ»è¿”ç­”</a></li>
                    <li><a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
                </ul>
            </nav>
        </header>

        <main class="container">
            <div class="page-header">
                <h1>è³ªå•ãƒ»è¿”ç­”ä¸€è¦§</h1>
                <a href="/viewer/question/new" class="new-question-btn">æ–°ã—ã„è³ªå•ã‚’ã™ã‚‹</a>
            </div>

            <div class="search-section">
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="è³ªå•ã‚’æ¤œç´¢...">
                    <button type="button" class="search-btn">æ¤œç´¢</button>
                </div>
                <div class="filter-options">
                    <select id="category-filter">
                        <option value="all">ã™ã¹ã¦ã®èª²ç¨‹</option>
                        <option value="ä¿®å­¦åŸºç¤">ä¿®å­¦åŸºç¤</option>
                        <option value="äººé–“å½¢æˆåŸºç¤">äººé–“å½¢æˆåŸºç¤</option>
                        <option value="ç”Ÿæ¶¯ã‚¹ãƒãƒ¼ãƒ„">ç”Ÿæ¶¯ã‚¹ãƒãƒ¼ãƒ„</option>
                        <option value="è‹±èª">è‹±èª</option>
                        <option value="æ•°ç†åŸºç¤">æ•°ç†åŸºç¤</option>
                        <option value="åŸºç¤ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ">åŸºç¤ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
                        <option value="æ•™è·">æ•™è·</option>
                        <option value="æ–‡ç†æ¨ªæ–­">æ–‡ç†æ¨ªæ–­</option>
                        <option value="å°‚é–€">å°‚é–€</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                    <select id="status-filter">
                        <option value="all">ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                        <option value="answered">å›ç­”æ¸ˆã¿</option>
                        <option value="unanswered">æœªå›ç­”</option>
                    </select>
                </div>
            </div>

            <div class="questions-container">
                <!-- è³ªå•ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã«ã‚ˆã£ã¦å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
            </div>

            <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="pagination">
                <button class="page-btn" disabled>å‰ã¸</button>
                <span class="page-info">1 / 1</span>
                <button class="page-btn" disabled>æ¬¡ã¸</button>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <p><a href="/#">åˆ©ç”¨è¦ç´„</a></p>
                <p>&copy; 2025 Hackit ã•ãã€ãã£ã¨ã€‚</p>
            </div>
        </footer>
    </div>

    <script type="module">
        import { getAuth, onAuthStateChanged } from "firebase/auth";
        import '/firebase.js';

        async function renderQuestions() {
            const questionsContainer = document.querySelector('.questions-container');
            if (!questionsContainer) return;

            questionsContainer.innerHTML = '<p>è³ªå•ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>';

            try {
                const snapshot = await window.getQuestions();
                if (snapshot.empty) {
                    questionsContainer.innerHTML = '<p>ã¾ã è³ªå•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                    return;
                }

                questionsContainer.innerHTML = ''; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢

                snapshot.forEach(doc => {
                    const question = doc.data();
                    const questionId = doc.id;

                    const card = document.createElement('div');
                    card.className = 'question-card';
                    card.dataset.category = question.course_label.toLowerCase();
                    card.dataset.status = question.is_solved ? 'answered' : 'unanswered';
                    
                    const solvedStatus = question.is_solved 
                        ? '<span class="status answered">å›ç­”æ¸ˆã¿</span>' 
                        : '<span class="status unanswered">æœªå›ç­”</span>';
                    
                    const contentPreview = question.content ? question.content.substring(0, 100) + (question.content.length > 100 ? '...' : '') : '';

                    card.innerHTML = `
                        <div class="question-header">
                            <span class="category-tag">${question.course_label || 'ã‚«ãƒ†ã‚´ãƒªãªã—'}</span>
                            ${solvedStatus}
                        </div>
                        <h3 class="question-title">${question.title}</h3>
                        <p class="question-preview">${contentPreview}</p>
                        <div class="question-meta">
                            <span class="author">æŠ•ç¨¿è€…: ${question.user.name || 'åŒ¿å'}</span>
                            <span class="date">${question.date ? question.date.toDate().toLocaleString('ja-JP') : 'æ—¥ä»˜ä¸æ˜'}</span>
                            <span class="answers-count">å›ç­”æ•°: ${question.ans_count}</span>
                        </div>
                        <div class="question-actions">
                            <a href="/viewer/question/detail.html?id=${questionId}" class="view-btn">è©³ç´°ã‚’è¦‹ã‚‹</a>
                            <button class="like-btn">ğŸ‘ ${question.good_count}</button>
                        </div>
                    `;
                    questionsContainer.appendChild(card);
                });
            } catch (error) {
                console.error("è³ªå•ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                questionsContainer.innerHTML = '<p>è³ªå•ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const auth = getAuth();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    renderQuestions();
                } else {
                    window.location.href = '/login.html';
                }
            });
        });
    </script>
    <script src="/js/question-list.js" defer></script>
</body>

</html>